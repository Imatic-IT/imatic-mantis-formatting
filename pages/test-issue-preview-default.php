<?php



$t_issue = [
    'id' => 1,
    'summary' => 'Normal HTML content',
    'description' => ``
];

$t_result = [
    'issue' => [
        'id' => 1202,
        'summary' => 'Lorem ipsum dolor sit amet, consectetur adipiscing elit [1111111]',
        'description' => <<<EOD
Email From: no-reply@loremipsum.com
Email To: sales@dolorsitamet.cz
[Email link](thunderlink://messageid=E1utKv5-007OjW-PY@smtp1.loremipsum.cz)

Email from: no-reply@loremipsum.com

<p style="margin: 0cm; line-height: 18.0pt; background: white;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;">lorem ipsum lorem ipsum,</span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;"> </span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;">Lorem Ipsum is simply dummy text<strong> lorem ipsum lorem ipsum lorem ipsum - lorem ipsum, Lorem Ipsum</strong> lorem <strong>lorem ipsum, a.s.</strong> lorem ipsum <strong>lorem ipsum</strong> lorem ipsum lorem ipsum <strong>lorem ipsum</strong>, lorem ipsum lorem ipsum lorem ipsum:</span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;"> </span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;">- lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum <strong>lorem ipsum</strong>, lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum </span><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: black;"><a href="lorem ipsum">lorem ipsum lorem ipsum 4U</a></span><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;">, lorem ipsum <u>lorem ipsum</u> lorem ipsum lorem ipsum lorem ipsum <u>lorem ipsum</u> lorem ipsum lorem ipsum lorem ipsum</span><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: black;">.</span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;"> </span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;">- lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum, lorem ipsum lorem ipsum lorem ipsum lorem ipsum: </span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;">lorem ipsum lorem ipsum lorem ipsum, <a href="mailto:loremipsum@loremipsum.cz">loremipsum@loremipsum.cz</a> lorem ipsum <a href="mailto:loremipsum@loremipsum.cz"><span style="color: #007acc;">loremipsum@loremipsum.cz</span></a>.</span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;"> </span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;">- lorem ipsum lorem ipsum lorem ipsum, lorem ipsum lorem ipsum, lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum. </span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;"> </span></p>
<p style="margin: 0cm; line-height: 18.0pt; background: white; font-variant-ligatures: normal; font-variant-caps: normal; orphans: 2; text-align: start; widows: 2; -webkit-text-stroke-width: 0px; text-decoration-thickness: initial; text-decoration-style: initial; text-decoration-color: initial; word-spacing: 0px;"><span style="font-size: 10.5pt; font-family: 'Segoe UI',sans-serif; color: #222222;">- lorem ipsum lorem ipsum lorem ipsum lorem ipsum, lorem ipsum lorem ipsum lorem ipsum. lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum lorem ipsum.</span></p>
EOD,
        'project' => [
            'id' => 4,
            'name' => 'Test',
        ],
        'category' => [
            'id' => 1,
            'name' => 'General',
        ],
        'reporter' => [
            'id' => 4,
            'name' => 'Mail69011',
            'real_name' => 'Mail Reporter',
        ],
        'status' => [
            'id' => 10,
            'name' => 'new',
            'label' => 'nový',
            'color' => '#ffa0a0',
        ],
        'resolution' => [
            'id' => 10,
            'name' => 'open',
            'label' => 'otevřený',
        ],
        'view_state' => [
            'id' => 50,
            'name' => 'private',
            'label' => 'soukromý',
        ],
        'priority' => [
            'id' => 30,
            'name' => 'normal',
            'label' => 'normální',
        ],
        'severity' => [
            'id' => 50,
            'name' => 'minor',
            'label' => 'malá',
        ],
        'reproducibility' => [
            'id' => 70,
            'name' => 'have not tried',
            'label' => 'nevyzkoušeno',
        ],
        'sticky' => null,
        'created_at' => '2025-09-17T14:19:54+02:00',
        'updated_at' => '2025-09-18T11:57:07+02:00',
        'notes' => [
            [
                'id' => 1281,
                'reporter' => [
                    'id' => 10,
                    'name' => 'matejbrodziansky@gmail.com',
                    'real_name' => 'Matej Brodziansky',
                    'email' => 'matejbrodziansky+2@gmail.com',
                ],
                'text' => '@matejbrodziansky@gmail.com  **test BOLD**',
                'view_state' => [
                    'id' => 50,
                    'name' => 'private',
                    'label' => 'soukromý',
                ],
                'attachments' => [],
                'type' => 'note',
                'created_at' => '2025-09-17T14:46:07+02:00',
                'updated_at' => '2025-09-17T14:46:07+02:00',
            ],
            [
                'id' => 1282,
                'reporter' => [
                    'id' => 10,
                    'name' => 'matejbrodziansky@gmail.com',
                    'real_name' => 'Matej Brodziansky',
                    'email' => 'matejbrodziansky+2@gmail.com',
                ],
                'text' => "**test bold**\n\ntestbold strong",
                'view_state' => [
                    'id' => 50,
                    'name' => 'private',
                    'label' => 'soukromý',
                ],
                'attachments' => [],
                'type' => 'note',
                'created_at' => '2025-09-17T14:46:44+02:00',
                'updated_at' => '2025-09-17T14:46:44+02:00',
            ],
            [
                'id' => 1283,
                'reporter' => [
                    'id' => 10,
                    'name' => 'matejbrodziansky@gmail.com',
                    'real_name' => 'Matej Brodziansky',
                    'email' => 'matejbrodziansky+2@gmail.com',
                ],
                'text' => '@matejbrodziansky@gmail.com',
                'view_state' => [
                    'id' => 50,
                    'name' => 'private',
                    'label' => 'soukromý',
                ],
                'attachments' => [],
                'type' => 'note',
                'created_at' => '2025-09-18T11:57:07+02:00',
                'updated_at' => '2025-09-18T11:57:07+02:00',
            ],
        ],
        'monitors' => [
            [
                'id' => 10,
                'name' => 'matejbrodziansky@gmail.com',
                'real_name' => 'Matej Brodziansky',
                'email' => 'matejbrodziansky+2@gmail.com',
            ],
        ],
        'history' => [
            [
                'created_at' => '2025-09-17T14:19:54+02:00',
                'user' => [
                    'id' => 4,
                    'name' => 'Mail69011',
                    'real_name' => 'Mail Reporter',
                ],
                'type' => [
                    'id' => 1,
                    'name' => 'issue-new',
                ],
                'message' => 'Nový záznam',
            ],
            [
                'created_at' => '2025-09-17T14:46:07+02:00',
                'user' => [
                    'id' => 10,
                    'name' => 'matejbrodziansky@gmail.com',
                    'real_name' => 'Matej Brodziansky',
                    'email' => 'matejbrodziansky+2@gmail.com',
                ],
                'type' => [
                    'id' => 2,
                    'name' => 'note-added',
                ],
                'note' => [
                    'id' => 1281,
                ],
                'message' => 'Poznámka přidána: 0001281',
            ],
            [
                'created_at' => '2025-09-17T14:46:07+02:00',
                'user' => [
                    'id' => 10,
                    'name' => 'matejbrodziansky@gmail.com',
                    'real_name' => 'Matej Brodziansky',
                    'email' => 'matejbrodziansky+2@gmail.com',
                ],
                'type' => [
                    'id' => 12,
                    'name' => 'monitor-added',
                ],
                'old_value' => 10,
                'new_value' => null,
                'message' => 'Záznam sledován: matejbrodziansky@gmail.com',
            ],
            [
                'created_at' => '2025-09-17T14:46:44+02:00',
                'user' => [
                    'id' => 10,
                    'name' => 'matejbrodziansky@gmail.com',
                    'real_name' => 'Matej Brodziansky',
                    'email' => 'matejbrodziansky+2@gmail.com',
                ],
                'type' => [
                    'id' => 2,
                    'name' => 'note-added',
                ],
                'note' => [
                    'id' => 1282,
                ],
                'message' => 'Poznámka přidána: 0001282',
            ],
            [
                'created_at' => '2025-09-18T11:57:07+02:00',
                'user' => [
                    'id' => 10,
                    'name' => 'matejbrodziansky@gmail.com',
                    'real_name' => 'Matej Brodziansky',
                    'email' => 'matejbrodziansky+2@gmail.com',
                ],
                'type' => [
                    'id' => 2,
                    'name' => 'note-added',
                ],
                'note' => [
                    'id' => 1283,
                ],
                'message' => 'Poznámka přidána: 0001283',
            ],
        ],
    ],
    'issue_view' => [
        'form_title' => 'Detaily problému',
        'id_formatted' => '0001202',
        'created_at' => '2025-09-17 14:19',
        'updated_at' => '2025-09-18 11:57',
        'overdue' => null,
        'due_date' => null,
        'links' => [],
    ],
    'flags' => [
        'summary_show' => 1,
        'description_show' => 1,
        'versions_show' => null,
        'versions_product_version_show' => null,
        'versions_fixed_in_version_show' => null,
        'versions_product_build_show' => null,
        'versions_target_version_show' => null,
        'history_show' => 1,
        'reminder_can_add' => 1,
        'id_show' => 1,
        'created_at_show' => 1,
        'updated_at_show' => 1,
        'additional_information_show' => null,
        'steps_to_reproduce_show' => null,
        'tags_show' => 1,
        'tags_can_attach' => 1,
        'due_date_show' => 1,
        'relationships_show' => 1,
        'relationships_can_update' => 1,
        'sponsorships_show' => null,
        'profiles_show' => null,
        'profiles_platform_show' => null,
        'profiles_os_show' => null,
        'profiles_os_build_show' => null,
        'monitor_show' => 1,
        'monitor_can_delete' => 1,
        'monitor_can_add' => 1,
        'can_monitor' => null,
        'can_unmonitor' => 1,
        'attachments_show' => 1,
        'category_show' => 1,
        'eta_show' => null,
        'handler_show' => 1,
        'priority_show' => 1,
        'project_show' => 1,
        'projection_show' => null,
        'reporter_show' => 1,
        'reproducibility_show' => null,
        'resolution_show' => null,
        'severity_show' => 1,
        'status_show' => 1,
        'view_state_show' => 1,
        'can_update' => 1,
        'can_assign' => 1,
        'can_change_status' => 1,
        'can_clone' => 1,
        'can_reopen' => null,
        'can_close' => 1,
        'can_move' => 1,
        'can_delete' => 1,
        'can_sticky' => 1,
        'can_unsticky' => null,
    ],
];
$t_issue = $t_result['issue'];
$t_issue_view = $t_result['issue_view'];
$t_flags = $t_result['flags'];
echo '<div class="col-md-12 col-xs-12">';
echo '<div class="widget-box widget-color-blue2">';
echo '<div class="widget-header widget-header-small">';
echo '<h4 class="widget-title lighter">';
echo '<i class="ace-icon fa fa-bars"></i>';
// echo string_display_line( $t_issue_view['form_title'] );
echo '</h4>';
echo '</div>';

echo '<div class="widget-body">';

echo '<div class="widget-toolbox padding-8 clearfix noprint">';
echo '<div class="btn-group pull-left">';

echo '</div>';


echo '<div class="btn-group pull-right">';

echo '</div>';
echo '</div>';

echo '<div class="widget-main no-padding">';
echo '<div class="table-responsive">';
echo '<table class="table table-bordered table-condensed">';


echo '<tbody>';

if (
    $t_flags['id_show'] || $t_flags['project_show'] || $t_flags['category_show'] ||
    $t_flags['view_state_show'] || $t_flags['created_at_show'] || $t_flags['updated_at_show']
) {

    # Labels
    echo '<tr class="bug-header">';
    echo '<th class="bug-id category" width="15%">', $t_flags['id_show'] ? lang_get('id') : '', '</th>';
    echo '<th class="bug-project category" width="20%">', $t_flags['project_show'] ? lang_get('email_project') : '', '</th>';
    echo '<th class="bug-category category" width="15%">', $t_flags['category_show'] ? lang_get('category') : '', '</th>';
    echo '<th class="bug-view-status category" width="15%">', $t_flags['view_state_show'] ? lang_get('view_status') : '', '</th>';
    echo '<th class="bug-date-submitted category" width="15%">', $t_flags['created_at_show'] ? lang_get('date_submitted') : '', '</th>';
    echo '<th class="bug-last-modified category" width="20%">', $t_flags['updated_at_show'] ? lang_get('last_update') : '', '</th>';
    echo '</tr>';

    echo '<tr class="bug-header-data">';

    # Bug ID
    echo '<td class="bug-id">', $t_flags['id_show'] ? $t_issue_view['id_formatted'] : '', '</td>';

    # Project
    echo '<td class="bug-project">', $t_flags['project_show'] && isset($t_issue['project']['name']) ? string_display_line($t_issue['project']['name']) : '', '</td>';

    # Category
    echo '<td class="bug-category">',
    $t_flags['category_show'] && isset($t_issue['category']['name'])
        ? string_display_line($t_issue['category']['name'])
        : '',
    '</td>';

    # View Status
    echo '<td class="bug-view-status">', $t_flags['view_state_show'] && isset($t_issue['view_state']['label']) ? string_display_line($t_issue['view_state']['label']) : '', '</td>';

    # Date Submitted
    echo '<td class="bug-date-submitted">', $t_flags['created_at_show'] ? $t_issue_view['created_at'] : '', '</td>';

    # Date Updated
    echo '<td class="bug-last-modified">',  $t_flags['updated_at_show'] ? $t_issue_view['updated_at'] : '', '</td>';

    echo '</tr>';

    # spacer
    echo '<tr class="spacer"><td colspan="6"></td></tr>';
    echo '<tr class="hidden"></tr>';
}

#
# Reporter, Handler, Due Date
#

if ($t_flags['reporter_show'] || $t_flags['handler_show'] || $t_flags['due_date_show']) {
    echo '<tr>';

    $t_spacer = 0;

    # Reporter
    if ($t_flags['reporter_show']) {
        echo '<th class="bug-reporter category">', lang_get('reporter'), '</th>';
        echo '<td class="bug-reporter">';
        // print_user_with_subject($t_issue['reporter']['id'], $f_issue_id);
        echo '</td>';
    } else {
        $t_spacer += 2;
    }

    # Handler
    if ($t_flags['handler_show']) {
        echo '<th class="bug-assigned-to category">', lang_get('assigned_to'), '</th>';
        echo '<td class="bug-assigned-to">';
        if (isset($t_issue['handler'])) {
            // print_user_with_subject($t_issue['handler']['id'], $f_issue_id);
        }
        echo '</td>';
    } else {
        $t_spacer += 2;
    }

    # Due Date
    if ($t_flags['due_date_show']) {
        echo '<th class="bug-due-date category">', lang_get('due_date'), '</th>';

        $t_css = 'bug-due-date';
        if ($t_issue_view['overdue'] !== false) {
            $t_css .= ' due-' . $t_issue_view['overdue'];
        }
        echo '<td class="' . $t_css . '">', $t_issue_view['due_date'], '</td>';
    } else {
        $t_spacer += 2;
    }

    if ($t_spacer > 0) {
        echo '<td colspan="', $t_spacer, '">&#160;</td>';
    }

    echo '</tr>';
}

#
# Priority, Severity, Reproducibility
#

if ($t_flags['priority_show'] || $t_flags['severity_show'] || $t_flags['reproducibility_show']) {
    echo '<tr>';

    $t_spacer = 0;

    # Priority
    if ($t_flags['priority_show']) {
        echo '<th class="bug-priority category">', lang_get('priority'), '</th>';
        echo '<td class="bug-priority">', string_display_line($t_issue['priority']['label']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # Severity
    if ($t_flags['severity_show']) {
        echo '<th class="bug-severity category">', lang_get('severity'), '</th>';
        echo '<td class="bug-severity">', string_display_line($t_issue['severity']['label']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # Reproducibility
    if ($t_flags['reproducibility_show']) {
        echo '<th class="bug-reproducibility category">', lang_get('reproducibility'), '</th>';
        echo '<td class="bug-reproducibility">', string_display_line($t_issue['reproducibility']['label']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # spacer
    if ($t_spacer > 0) {
        echo '<td colspan="', $t_spacer, '">&#160;</td>';
    }

    echo '</tr>';
}

#
# Status, Resolution
#

if ($t_flags['status_show'] || $t_flags['resolution_show']) {
    echo '<tr>';

    $t_spacer = 2;

    # Status
    if ($t_flags['status_show']) {
        echo '<th class="bug-status category">', lang_get('status'), '</th>';

        # choose color based on status
        $t_status_css = html_get_status_css_fg($t_issue['status']['id']);

        echo '<td class="bug-status">';
        echo '<i class="fa fa-square fa-status-box ' . $t_status_css . '"></i> ';
        echo string_display_line($t_issue['status']['label']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # Resolution
    if ($t_flags['resolution_show']) {
        echo '<th class="bug-resolution category">', lang_get('resolution'), '</th>';
        echo '<td class="bug-resolution">', string_display_line($t_issue['resolution']['label']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # spacer
    if ($t_spacer > 0) {
        echo '<td colspan="', $t_spacer, '">&#160;</td>';
    }

    echo '</tr>';
}


#
# Projection, ETA
#

if ($t_flags['projection_show'] || $t_flags['eta_show']) {
    echo '<tr>';

    $t_spacer = 2;

    if ($t_flags['projection_show']) {
        # Projection
        echo '<th class="bug-projection category">', lang_get('projection'), '</th>';
        echo '<td class="bug-projection">', string_display_line($t_issue['projection']['label']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # ETA
    if ($t_flags['eta_show']) {
        echo '<th class="bug-eta category">', lang_get('eta'), '</th>';
        echo '<td class="bug-eta">', string_display_line($t_issue['eta']['label']), '</td>';
    } else {
        $t_spacer += 2;
    }

    echo '<td colspan="', $t_spacer, '">&#160;</td>';
    echo '</tr>';
}

#
# Platform, OS, OS Version
#

if (($t_flags['profiles_platform_show'] && isset($t_issue['platform']) && !is_blank($t_issue['platform'])) ||
    ($t_flags['profiles_os_show'] && isset($t_issue['os']) && !is_blank($t_issue['os'])) ||
    ($t_flags['profiles_os_build_show'] && isset($t_issue['os_build']) && !is_blank($t_issue['os_build']))
) {
    $t_spacer = 0;

    echo '<tr>';

    # Platform
    if ($t_flags['profiles_platform_show'] && isset($t_issue['platform']) && !is_blank($t_issue['platform'])) {
        echo '<th class="bug-platform category">', lang_get('platform'), '</th>';
        echo '<td class="bug-platform">', string_display_line($t_issue['platform']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # Operating System
    if ($t_flags['profiles_os_show'] && isset($t_issue['os']) && !is_blank($t_issue['os'])) {
        echo '<th class="bug-os category">', lang_get('os'), '</th>';
        echo '<td class="bug-os">', string_display_line($t_issue['os']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # OS Version
    if ($t_flags['profiles_os_build_show'] && isset($t_issue['os_build']) && !is_blank($t_issue['os_build'])) {
        echo '<th class="bug-os-version category">', lang_get('os_version'), '</th>';
        echo '<td class="bug-os-version">', string_display_line($t_issue['os_build']), '</td>';
    } else {
        $t_spacer += 2;
    }

    if ($t_spacer > 0) {
        echo '<td colspan="', $t_spacer, '">&#160;</td>';
    }

    echo '</tr>';
}

#
# Product Version, Product Build
#

if (($t_flags['versions_product_version_show'] && isset($t_issue['version'])) ||
    ($t_flags['versions_product_build_show'] && isset($t_issue['build']))
) {
    $t_spacer = 2;

    echo '<tr>';

    # Product Version
    if ($t_flags['versions_product_version_show'] && isset($t_issue['version'])) {
        echo '<th class="bug-product-version category">', lang_get('product_version'), '</th>';
        echo '<td class="bug-product-version">', string_display_line($t_issue['version']['name']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # Product Build
    if ($t_flags['versions_product_build_show'] && isset($t_issue['build'])) {
        echo '<th class="bug-product-build category">', lang_get('product_build'), '</th>';
        echo '<td class="bug-product-build">', string_display_line($t_issue['build']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # spacer
    echo '<td colspan="', $t_spacer, '">&#160;</td>';

    echo '</tr>';
}

#
# Target Version, Fixed In Version
#

if (($t_flags['versions_target_version_show'] && isset($t_issue['target_version'])) ||
    ($t_flags['versions_fixed_in_version_show'] && isset($t_issue['fixed_in_version']))
) {
    $t_spacer = 2;

    echo '<tr>';

    # target version
    if ($t_flags['versions_target_version_show'] && isset($t_issue['target_version'])) {
        # Target Version
        echo '<th class="bug-target-version category">', lang_get('target_version'), '</th>';
        echo '<td class="bug-target-version">', string_display_line($t_issue['target_version']['name']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # fixed in version
    if ($t_flags['versions_fixed_in_version_show'] && isset($t_issue['fixed_in_version'])) {
        echo '<th class="bug-fixed-in-version category">', lang_get('fixed_in_version'), '</th>';
        echo '<td class="bug-fixed-in-version">', string_display_line($t_issue['fixed_in_version']['name']), '</td>';
    } else {
        $t_spacer += 2;
    }

    # spacer
    echo '<td colspan="', $t_spacer, '">&#160;</td>';

    echo '</tr>';
}

#
# Bug Details Event Signal
#

// event_signal('EVENT_VIEW_BUG_DETAILS', array($f_issue_id));

# spacer
echo '<tr class="spacer"><td colspan="6"></td></tr>';
echo '<tr class="hidden"></tr>';

#
# Bug Details (screen wide fields)
#
# Summary
// pre_r('tttttttttttest');
if ($t_flags['summary_show'] && isset($t_issue['summary'])) {
    echo '<tr>';
    echo '<th class="bug-summary category">', lang_get('summary'), '</th>';
    // echo '<td class="bug-summary" colspan="5">', string_display_line(bug_format_id($f_issue_id) . ': ' . $t_issue['summary']), '</td>';
    echo '</tr>';
}

# Description
if ($t_flags['description_show'] && isset($t_issue['description'])) {
    echo '<tr>';
    echo '<th class="bug-description category">', lang_get('description'), '</th>';
    echo '<td class="bug-description" colspan="5">', string_display_links($t_issue['description']), '</td>';
    echo '</tr>';
}

# Steps to Reproduce
if ($t_flags['steps_to_reproduce_show'] && isset($t_issue['steps_to_reproduce'])) {
    echo '<tr>';
    echo '<th class="bug-steps-to-reproduce category">', lang_get('steps_to_reproduce'), '</th>';
    echo '<td class="bug-steps-to-reproduce" colspan="5">', string_display_links($t_issue['steps_to_reproduce']), '</td>';
    echo '</tr>';
}

# Additional Information
if ($t_flags['additional_information_show'] && isset($t_issue['additional_information'])) {
    echo '<tr>';
    echo '<th class="bug-additional-information category">', lang_get('additional_information'), '</th>';
    echo '<td class="bug-additional-information" colspan="5">', string_display_links($t_issue['additional_information']), '</td>';
    echo '</tr>';
}

# Tagging
if ($t_flags['tags_show']) {
    echo '<tr>';
    echo '<th class="bug-tags category">', lang_get('tags'), '</th>';
    echo '<td class="bug-tags" colspan="5">';
    // tag_display_attached($f_issue_id);
    echo '</td></tr>';
}


# spacer
echo '<tr class="spacer"><td colspan="6"></td></tr>';
echo '<tr class="hidden"></tr>';

# Custom Fields
if (isset($t_issue['custom_fields'])) {
    foreach ($t_issue['custom_fields'] as $t_custom_field) {
        $t_def = custom_field_get_definition($t_custom_field['field']['id']);

        echo '<tr>';
        echo '<th class="bug-custom-field category">', string_display_line(lang_get_defaulted($t_def['name'])), '</th>';
        echo '<td class="bug-custom-field" colspan="5">';
        // print_custom_field_value($t_def, $t_custom_field['field']['id'], $f_issue_id);
        echo '</td></tr>';
    }

    # spacer
    echo '<tr class="spacer"><td colspan="6"></td></tr>';
    echo '<tr class="hidden"></tr>';
}

echo '</tbody></table>';
echo '</div></div></div></div>';